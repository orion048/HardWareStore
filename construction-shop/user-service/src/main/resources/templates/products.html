<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</title>
    <link rel="stylesheet" th:href="@{/css/products.css}" />
    <script>
        async function addToCart(productId) {
            const quantity = document.getElementById('qty-' + productId).value;
            const response = await fetch('/shop/add-to-cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `productId=${productId}&quantity=${quantity}`
            });
            if (response.ok) {
                alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
                updateCartCount();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏.');
            }
        }

        async function updateCartCount() {
            const res = await fetch('/shop/cart-count');
            const count = await res.text();
            document.getElementById('cart-count').innerText = count;
        }

        window.onload = updateCartCount;
    </script>
</head>
<body>
<header>
    <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>
    <nav class="top-nav">
        <a href="/auth/home" class="nav-button">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/auth/profile" class="nav-button">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="/shop/cart" class="nav-button">üõí –ö–æ—Ä–∑–∏–Ω–∞: <span id="cart-count">0</span></a>
    </nav>
</header>

<div class="product-grid">
    <div th:each="product : ${products}" class="product-card">
        <img th:src="@{${product.imageUrl}}" alt="–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞" class="product-image" />

        <h3 th:text="${product.productName}">–ù–∞–∑–≤–∞–Ω–∏–µ</h3>
        <p>–¶–µ–Ω–∞: <span th:text="${product.price}">0.00</span> ‚ÇΩ</p>
        <p>–í –Ω–∞–ª–∏—á–∏–∏: <span th:text="${product.quantity}">0</span></p>

        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:
            <input type="number" th:id="|qty-${product.id}|" value="1" min="1" th:attr="max=${product.quantity}" />
        </label>
        <button th:attr="onclick=|addToCart(${product.id})|">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
</div>
</body>
</html>
