<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <link rel="stylesheet" href="/css/order.css" />
</head>
<body>
<div class="container">

    <div th:if="${user != null}">
        <h2>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, <span th:text="${user.firstName + ' ' + user.lastName}">–§–ò–û</span>!</h2>
        <p>Email: <span th:text="${user.email}">email@example.com</span></p>

        <a href="/auth/home" class="home-button">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>

        <!-- üì¶ –ó–∞–∫–∞–∑—ã -->
        <div th:if="${#lists.isEmpty(user.orders)}">
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</p>
        </div>

        <div th:each="order : ${orders}">
            <hr/>
            <p><strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> <span th:text="${order.deliveryAddress}">–ê–¥—Ä–µ—Å</span></p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status" th:text="${order.status}">–°—Ç–∞—Ç—É—Å</span></p>

            <h3>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤:</h3>
            <table>
                <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    <th>–¶–µ–Ω–∞</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(order.items)}">
                    <td colspan="3">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∑–∞–∫–∞–∑–µ</td>
                </tr>
                <tr th:each="item : ${order.items}">
                    <td th:text="${item.product.productName}">–¢–æ–≤–∞—Ä</td>
                    <td th:text="${item.quantity}">0</td>
                    <td th:text="${item.price}">0.0</td>
                </tr>
                </tbody>
            </table>

            <!-- üí∞ –°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ -->
            <p><strong>–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞:</strong> <span th:text="${order.totalAmount}">0.00</span> ‚ÇΩ</p>
            <!-- üîò –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã -->
            <form th:action="@{/auth/payment}" method="get">
                <input type="hidden" name="orderId" th:value="${order.id}" />
                <button type="submit" class="pay-button">–û–ø–ª–∞—Ç–∏—Ç—å</button>
            </form>

        </div>


        <!-- ‚úèÔ∏è –ö–Ω–æ–ø–∫–∞ –∏ —Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –§–ò–û -->
        <hr/>
        <button onclick="toggleFioForm()" class="edit-fio-button">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –§–ò–û</button>

        <div id="edit-fio-form" style="display:none;">
            <form th:action="@{/auth/update-fio}" th:object="${user}" method="post" class="fio-form">
                <div class="form-group">
                    <label for="lastName">–§–∞–º–∏–ª–∏—è:</label>
                    <input type="text" th:field="*{lastName}" id="lastName" required/>
                </div>

                <div class="form-group">
                    <label for="firstName">–ò–º—è:</label>
                    <input type="text" th:field="*{firstName}" id="firstName" required/>
                </div>

                <div class="form-group">
                    <label for="middleName">–û—Ç—á–µ—Å—Ç–≤–æ:</label>
                    <input type="text" th:field="*{middleName}" id="middleName"/>
                </div>

                <button type="submit" class="save-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>

            <div th:if="${errorMessage}" class="error-message">
                <p th:text="${errorMessage}"></p>
            </div>
        </div>
    </div>

    <div th:if="${user == null}">
        <h2>–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</h2>
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, <a href="/auth/login">–≤–æ–π–¥–∏—Ç–µ</a> –≤ —Å–∏—Å—Ç–µ–º—É.</p>
    </div>

</div>

<script>
    function toggleFioForm() {
        const form = document.getElementById("edit-fio-form");
        form.style.display = form.style.display === "none" ? "block" : "none";
    }
</script>
</body>
</html>
